import{e as K,r as u,j as e,S as k,k as y,i as N,q as m,l as Q}from"./index-Bh151N_C.js";import{u as q}from"./useQuery-DE7gh7BB.js";import{u as v,P as A,S as L,T}from"./trash-2-D9UJycuj.js";import{S as U}from"./square-pen-YXaKsQSI.js";function J(){const l=K(),[x,g]=u.useState(""),[o,d]=u.useState(!1),[h,f]=u.useState(!1),[c,a]=u.useState(null),[n,s]=u.useState(null),[r,i]=u.useState(null),{data:p=[],isLoading:P}=q({queryKey:m.adminRoles(),queryFn:y.getRoles}),{data:w=[]}=q({queryKey:m.adminPermissions(),queryFn:Q.getPermissions}),R=v({mutationFn:y.createRole,onSuccess:()=>{i("Role created successfully"),d(!1),l.invalidateQueries({queryKey:m.adminRoles()}),l.invalidateQueries({queryKey:m.adminUsers()})},onError:t=>{s(t instanceof N?t.message:"Failed to create role")}}),C=v({mutationFn:({roleId:t,roleData:b})=>y.updateRole(t,b),onSuccess:()=>{i("Role updated successfully"),f(!1),a(null),l.invalidateQueries({queryKey:m.adminRoles()}),l.invalidateQueries({queryKey:m.adminUsers()})},onError:t=>{s(t instanceof N?t.message:"Failed to update role")}}),S=v({mutationFn:y.deleteRole,onSuccess:()=>{i("Role deleted successfully"),l.invalidateQueries({queryKey:m.adminRoles()}),l.invalidateQueries({queryKey:m.adminUsers()})},onError:t=>{s(t instanceof N?t.message:"Failed to delete role")}}),M=t=>{R.mutate(t)},E=t=>{c&&C.mutate({roleId:c.id,roleData:t})},F=t=>{confirm("Are you sure you want to delete this role? This action cannot be undone.")&&S.mutate(t)},D=P||R.isPending||C.isPending||S.isPending,_=p.filter(t=>t.name.toLowerCase().includes(x.toLowerCase())||t.description&&t.description.toLowerCase().includes(x.toLowerCase()));return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(k,{className:"h-7 w-7 text-emerald-600 mr-2"}),"Role Management"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Create and manage system roles with granular permissions"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Add Role"]})]}),n&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("p",{className:"text-red-800",children:n})}),r&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("p",{className:"text-green-800",children:r})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(L,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:x,onChange:t=>g(t.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search roles..."})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("ul",{className:"divide-y divide-gray-200",children:_.map(t=>{var b;return e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(k,{className:"h-5 w-5 text-emerald-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.description||"No description"}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[((b=t.permissions)==null?void 0:b.length)||0," permissions assigned"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{a(t),f(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:e.jsx(U,{className:"h-4 w-4"})}),t.name!=="admin"&&e.jsx("button",{onClick:()=>F(t.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:e.jsx(T,{className:"h-4 w-4"})})]})]}),t.permissions&&t.permissions.length>0&&e.jsx("div",{className:"mt-3 ml-14",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:t.permissions.map(j=>e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[j.resource,".",j.action]},j.id))})})]})},t.id)})})}),o&&e.jsx(z,{permissions:w,onClose:()=>d(!1),onSubmit:M}),h&&c&&e.jsx(O,{role:c,permissions:w,onClose:()=>{f(!1),a(null)},onSubmit:E})]})}function z({permissions:l,onClose:x,onSubmit:g}){const[o,d]=u.useState({name:"",description:"",permission_ids:[]}),h=a=>{a.preventDefault(),g(o)},f=(a,n)=>{d(s=>({...s,permission_ids:n?[...new Set([...s.permission_ids,a])]:s.permission_ids.filter(r=>r!==a)}))},c=l.reduce((a,n)=>(a[n.resource]||(a[n.resource]=[]),a[n.resource].push(n),a),{});return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-[600px] shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Role"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role Name"}),e.jsx("input",{type:"text",required:!0,value:o.name,onChange:a=>d(n=>({...n,name:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",placeholder:"e.g., IT Officer, Finance Manager"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:a=>d(n=>({...n,description:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",rows:3,placeholder:"Describe the role's responsibilities"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),e.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-md p-3",children:Object.entries(c).map(([a,n])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2 capitalize",children:a}),e.jsx("div",{className:"space-y-2 ml-4",children:n.map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.permission_ids.includes(s.id),onChange:r=>f(s.id,r.target.checked),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-700",children:[s.action,s.description&&e.jsxs("span",{className:"text-gray-500",children:[" - ",s.description]})]})]},s.id))})]},a))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create Role"})]})]})]})})})}function O({role:l,permissions:x,onClose:g,onSubmit:o}){var n;const[d,h]=u.useState({name:l.name,description:l.description||"",permission_ids:((n=l.permissions)==null?void 0:n.map(s=>s.id))||[]}),f=s=>{s.preventDefault(),o(d)},c=(s,r)=>{h(i=>({...i,permission_ids:r?[...new Set([...i.permission_ids,s])]:i.permission_ids.filter(p=>p!==s)}))},a=x.reduce((s,r)=>(s[r.resource]||(s[r.resource]=[]),s[r.resource].push(r),s),{});return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-[600px] shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Role"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role Name"}),e.jsx("input",{type:"text",required:!0,value:d.name,onChange:s=>h(r=>({...r,name:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",disabled:l.name==="admin"}),l.name==="admin"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Admin role name cannot be changed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:s=>h(r=>({...r,description:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),e.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-md p-3",children:Object.entries(a).map(([s,r])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2 capitalize",children:s}),e.jsx("div",{className:"space-y-2 ml-4",children:r.map(i=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.permission_ids.includes(i.id),onChange:p=>c(i.id,p.target.checked),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-700",children:[i.action,i.description&&e.jsxs("span",{className:"text-gray-500",children:[" - ",i.description]})]})]},i.id))})]},s))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Update Role"})]})]})]})})})}export{J as AdminRoles};
