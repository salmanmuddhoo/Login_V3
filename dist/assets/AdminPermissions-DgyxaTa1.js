import{e as K,r as m,j as e,K as F,S as L,l as f,i as b,q as u}from"./index-CCDmJWkH.js";import{u as Q}from"./useQuery-BmwldlV1.js";import{u as y,P as A,S as R,T}from"./trash-2-DvJDmWGi.js";import{S as z}from"./square-pen-BH-fZj6n.js";function V(){const t=K(),[l,d]=m.useState(""),[n,i]=m.useState(!1),[a,r]=m.useState(!1),[o,h]=m.useState(null),[j,g]=m.useState(null),[v,p]=m.useState(null),{data:C=[],isLoading:S}=Q({queryKey:u.adminPermissions(),queryFn:f.getPermissions}),N=y({mutationFn:f.createPermission,onSuccess:()=>{p("Permission created successfully"),i(!1),t.invalidateQueries({queryKey:u.adminPermissions()}),t.invalidateQueries({queryKey:u.adminRoles()})},onError:s=>{g(s instanceof b?s.message:"Failed to create permission")}}),w=y({mutationFn:({permissionId:s,permissionData:c})=>f.updatePermission(s,c),onSuccess:()=>{p("Permission updated successfully"),r(!1),h(null),t.invalidateQueries({queryKey:u.adminPermissions()}),t.invalidateQueries({queryKey:u.adminRoles()})},onError:s=>{g(s instanceof b?s.message:"Failed to update permission")}}),P=y({mutationFn:f.deletePermission,onSuccess:()=>{p("Permission deleted successfully"),t.invalidateQueries({queryKey:u.adminPermissions()}),t.invalidateQueries({queryKey:u.adminRoles()})},onError:s=>{g(s instanceof b?s.message:"Failed to delete permission")}}),k=s=>{N.mutate(s)},q=s=>{o&&w.mutate({permissionId:o.id,permissionData:s})},E=s=>{confirm("Are you sure you want to delete this permission? This action cannot be undone.")&&P.mutate(s)},M=S||N.isPending||w.isPending||P.isPending,D=C.filter(s=>s.resource.toLowerCase().includes(l.toLowerCase())||s.action.toLowerCase().includes(l.toLowerCase())||s.description&&s.description.toLowerCase().includes(l.toLowerCase())).reduce((s,c)=>(s[c.resource]||(s[c.resource]=[]),s[c.resource].push(c),s),{});return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(F,{className:"h-7 w-7 text-emerald-600 mr-2"}),"Permission Management"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Create and manage system permissions for granular access control"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Add Permission"]})]}),j&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("p",{className:"text-red-800",children:j})}),v&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("p",{className:"text-green-800",children:v})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(R,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:l,onChange:s=>d(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search permissions..."})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:M?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("div",{className:"space-y-6 p-6",children:Object.entries(D).map(([s,c])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 capitalize flex items-center",children:[e.jsx(L,{className:"h-5 w-5 text-emerald-600 mr-2"}),s," Permissions"]}),e.jsx("div",{className:"space-y-3",children:c.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[x.resource,".",x.action]}),e.jsx("div",{className:"text-sm text-gray-500",children:x.description||"No description"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{h(x),r(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>E(x.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:e.jsx(T,{className:"h-4 w-4"})})]})]},x.id))})]},s))})}),n&&e.jsx(U,{onClose:()=>i(!1),onSubmit:k}),a&&o&&e.jsx(I,{permission:o,onClose:()=>{r(!1),h(null)},onSubmit:q})]})}function U({onClose:t,onSubmit:l}){const[d,n]=m.useState({resource:"",action:"",description:""}),i=a=>{a.preventDefault(),l(d)};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Permission"}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Resource"}),e.jsx("input",{type:"text",required:!0,value:d.resource,onChange:a=>n(r=>({...r,resource:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",placeholder:"e.g., users, reports, transactions"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Action"}),e.jsx("input",{type:"text",required:!0,value:d.action,onChange:a=>n(r=>({...r,action:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",placeholder:"e.g., create, read, update, delete"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:a=>n(r=>({...r,description:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",rows:3,placeholder:"Describe what this permission allows"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create Permission"})]})]})]})})})}function I({permission:t,onClose:l,onSubmit:d}){const[n,i]=m.useState({resource:t.resource,action:t.action,description:t.description||""}),a=r=>{r.preventDefault(),d(n)};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Permission"}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Resource"}),e.jsx("input",{type:"text",required:!0,value:n.resource,onChange:r=>i(o=>({...o,resource:r.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Action"}),e.jsx("input",{type:"text",required:!0,value:n.action,onChange:r=>i(o=>({...o,action:r.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:n.description,onChange:r=>i(o=>({...o,description:r.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Update Permission"})]})]})]})})})}export{V as AdminPermissions};
