var T=r=>{throw TypeError(r)};var q=(r,s,t)=>s.has(r)||T("Cannot "+t);var d=(r,s,t)=>(q(r,s,"read from private field"),t?t.call(r):s.get(r)),v=(r,s,t)=>s.has(r)?T("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,t),N=(r,s,t,l)=>(q(r,s,"write to private field"),l?l.call(r,t):s.set(r,t),t),w=(r,s,t)=>(q(r,s,"access private method"),t);import{e as ee,s as se,f as Q,g as te,n as V,i as H,r as x,k as re,l as ae,c as O,a as le,j as e,S as ne,m as ie,o as C,p as E,q as _,t as de}from"./index-Btm7UasC.js";import{u as z}from"./useQuery-C0mjooDJ.js";import{S as oe}from"./square-pen-B1VBeNPN.js";var y,j,h,b,g,S,F,I,ce=(I=class extends ee{constructor(s,t){super();v(this,g);v(this,y);v(this,j);v(this,h);v(this,b);N(this,y,s),this.setOptions(t),this.bindMethods(),w(this,g,S).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var l;const t=this.options;this.options=d(this,y).defaultMutationOptions(s),se(this.options,t)||d(this,y).getMutationCache().notify({type:"observerOptionsUpdated",mutation:d(this,h),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&Q(t.mutationKey)!==Q(this.options.mutationKey)?this.reset():((l=d(this,h))==null?void 0:l.state.status)==="pending"&&d(this,h).setOptions(this.options)}onUnsubscribe(){var s;this.hasListeners()||(s=d(this,h))==null||s.removeObserver(this)}onMutationUpdate(s){w(this,g,S).call(this),w(this,g,F).call(this,s)}getCurrentResult(){return d(this,j)}reset(){var s;(s=d(this,h))==null||s.removeObserver(this),N(this,h,void 0),w(this,g,S).call(this),w(this,g,F).call(this)}mutate(s,t){var l;return N(this,b,t),(l=d(this,h))==null||l.removeObserver(this),N(this,h,d(this,y).getMutationCache().build(d(this,y),this.options)),d(this,h).addObserver(this),d(this,h).execute(s)}},y=new WeakMap,j=new WeakMap,h=new WeakMap,b=new WeakMap,g=new WeakSet,S=function(){var t;const s=((t=d(this,h))==null?void 0:t.state)??te();N(this,j,{...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset})},F=function(s){V.batch(()=>{var t,l,o,u,f,i,a,c;if(d(this,b)&&this.hasListeners()){const m=d(this,j).variables,p=d(this,j).context;(s==null?void 0:s.type)==="success"?((l=(t=d(this,b)).onSuccess)==null||l.call(t,s.data,m,p),(u=(o=d(this,b)).onSettled)==null||u.call(o,s.data,null,m,p)):(s==null?void 0:s.type)==="error"&&((i=(f=d(this,b)).onError)==null||i.call(f,s.error,m,p),(c=(a=d(this,b)).onSettled)==null||c.call(a,void 0,s.error,m,p))}this.listeners.forEach(m=>{m(d(this,j))})})},I);function R(r,s){const t=H(),[l]=x.useState(()=>new ce(t,r));x.useEffect(()=>{l.setOptions(r)},[l,r]);const o=x.useSyncExternalStore(x.useCallback(f=>l.subscribe(V.batchCalls(f)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),u=x.useCallback((f,i)=>{l.mutate(f,i).catch(re)},[l]);if(o.error&&ae(l.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:u,mutateAsync:o.mutate}}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=O("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=O("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=O("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function je(){const r=H(),s=le(),[t,l]=x.useState(""),[o,u]=x.useState(!1),[f,i]=x.useState(!1),[a,c]=x.useState(null),[m,p]=x.useState(null),[P,U]=x.useState(null),{data:M,isLoading:$}=z({queryKey:_.adminUsers(),queryFn:C.getUsers,initialData:{users:s.users}}),{data:D}=z({queryKey:_.roles(),queryFn:de.getRoles,initialData:s.roles}),K=R({mutationFn:C.createUser,onSuccess:()=>{U("User created successfully"),u(!1),r.invalidateQueries({queryKey:_.adminUsers()})},onError:n=>{p(n instanceof E?n.message:"Failed to create user")}}),L=R({mutationFn:({userId:n,userData:k})=>C.updateUser(n,k),onSuccess:()=>{U("User updated successfully"),i(!1),c(null),r.invalidateQueries({queryKey:_.adminUsers()})},onError:n=>{p(n instanceof E?n.message:"Failed to update user")}}),A=R({mutationFn:C.deleteUser,onSuccess:()=>{U("User deleted successfully"),r.invalidateQueries({queryKey:_.adminUsers()})},onError:n=>{p(n instanceof E?n.message:"Failed to delete user")}}),B=n=>{K.mutate(n)},G=n=>{a&&L.mutate({userId:a.id,userData:n})},J=n=>{confirm("Are you sure you want to delete this user?")&&A.mutate(n)},W=(M==null?void 0:M.users)||[],X=$||K.isPending||L.isPending||A.isPending,Y=W.filter(n=>n.email.toLowerCase().includes(t.toLowerCase())||n.full_name.toLowerCase().includes(t.toLowerCase()));return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage user accounts, roles, and permissions"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),m&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("p",{className:"text-red-800",children:m})}),P&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("p",{className:"text-green-800",children:P})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(me,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:t,onChange:n=>l(n.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search users..."})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:X?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("ul",{className:"divide-y divide-gray-200",children:Y.map(n=>{var k;return e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(ne,{className:"h-5 w-5 text-emerald-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.full_name||"No name"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${n.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:n.is_active?"Active":"Inactive"}),n.needs_password_reset&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Password Reset Required"})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:n.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Roles: ",((k=n.roles)==null?void 0:k.map(Z=>Z.name).join(", "))||"No roles"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{c(n),i(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>J(n.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:e.jsx(he,{className:"h-4 w-4"})})]})]})},n.id)})})}),o&&e.jsx(xe,{roles:D||[],onClose:()=>u(!1),onSubmit:B}),f&&a&&e.jsx(fe,{user:a,roles:D||[],onClose:()=>{i(!1),c(null)},onSubmit:G})]})}function xe({roles:r,onClose:s,onSubmit:t}){const[l,o]=x.useState({email:"",password:ie(),full_name:"",role_ids:[],menu_access:[],sub_menu_access:{},component_access:[]}),u=i=>{if(i.preventDefault(),l.role_ids.length===0){alert("Please select at least one role");return}t(l)},f=(i,a)=>{o(c=>({...c,role_ids:a?[...new Set([...c.role_ids,i])]:c.role_ids.filter(m=>m!==i)}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New User"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:l.email,onChange:i=>o(a=>({...a,email:i.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:l.full_name,onChange:i=>o(a=>({...a,full_name:i.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Temporary Password"}),e.jsx("input",{type:"text",value:l.password,onChange:i=>o(a=>({...a,password:i.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"User will be required to change this password on first login"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Roles"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:r.map(i=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.role_ids.includes(i.id),onChange:a=>f(i.id,a.target.checked),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:i.name})]},i.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create User"})]})]})]})})})}function fe({user:r,roles:s,onClose:t,onSubmit:l}){const[o,u]=x.useState({full_name:r.full_name,role_ids:r.role_ids||[],menu_access:r.menu_access||[],sub_menu_access:r.sub_menu_access||{},component_access:r.component_access||[],is_active:r.is_active,needs_password_reset:r.needs_password_reset||!1}),f=a=>{if(a.preventDefault(),o.role_ids.length===0){alert("Please select at least one role");return}l(o)},i=(a,c)=>{u(m=>({...m,role_ids:c?[...new Set([...m.role_ids,a])]:m.role_ids.filter(p=>p!==a)}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",value:r.email,disabled:!0,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:o.full_name,onChange:a=>u(c=>({...c,full_name:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Roles"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:s.map(a=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.role_ids.includes(a.id),onChange:c=>i(a.id,c.target.checked),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:a.name})]},a.id))})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:o.is_active,onChange:a=>u(c=>({...c,is_active:a.target.checked})),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Active"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"needs_password_reset",checked:o.needs_password_reset,onChange:a=>u(c=>({...c,needs_password_reset:a.target.checked})),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("label",{htmlFor:"needs_password_reset",className:"ml-2 text-sm text-gray-700",children:"Require password reset"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Update User"})]})]})]})})})}export{je as AdminUsers};
