import{e as A,a as L,r as c,j as e,S as K,g as T,f as p,i as j,q as f,k as Q}from"./index-9pW-t-sw.js";import{u as C}from"./useQuery-Bi1nLucc.js";import{u as N,P as z,S as $,T as B}from"./trash-2-3ZspfGgd.js";import{S as G}from"./square-pen-BVqPWt2h.js";function X(){const l=A(),u=L(),[m,d]=c.useState(""),[n,i]=c.useState(!1),[x,t]=c.useState(!1),[a,r]=c.useState(null),[o,h]=c.useState(null),[v,b]=c.useState(null),{data:y,isLoading:S}=C({queryKey:f.adminUsers(),queryFn:p.getUsers,initialData:{users:u.users}}),{data:w}=C({queryKey:f.adminRoles(),queryFn:Q.getRoles,initialData:u.roles}),_=N({mutationFn:p.createUser,onSuccess:()=>{b("User created successfully"),i(!1),l.invalidateQueries({queryKey:f.adminUsers()})},onError:s=>{h(s instanceof j?s.message:"Failed to create user")}}),U=N({mutationFn:({userId:s,userData:g})=>p.updateUser(s,g),onSuccess:()=>{b("User updated successfully"),t(!1),r(null),l.invalidateQueries({queryKey:f.adminUsers()})},onError:s=>{h(s instanceof j?s.message:"Failed to update user")}}),k=N({mutationFn:p.deleteUser,onSuccess:()=>{b("User deleted successfully"),l.invalidateQueries({queryKey:f.adminUsers()})},onError:s=>{h(s instanceof j?s.message:"Failed to delete user")}}),q=s=>{_.mutate(s)},F=s=>{a&&U.mutate({userId:a.id,userData:s})},E=s=>{confirm("Are you sure you want to delete this user?")&&k.mutate(s)},M=(y==null?void 0:y.users)||[],R=S||_.isPending||U.isPending||k.isPending,P=M.filter(s=>s.email.toLowerCase().includes(m.toLowerCase())||s.full_name.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage user accounts, roles, and permissions"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),o&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("p",{className:"text-red-800",children:o})}),v&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("p",{className:"text-green-800",children:v})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:m,onChange:s=>d(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search users..."})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:R?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("ul",{className:"divide-y divide-gray-200",children:P.map(s=>{var g;return e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(K,{className:"h-5 w-5 text-emerald-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.full_name||"No name"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_active?"Active":"Inactive"}),s.needs_password_reset&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Password Reset Required"})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Roles: ",((g=s.roles)==null?void 0:g.map(D=>D.name).join(", "))||"No roles"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{r(s),t(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>E(s.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:e.jsx(B,{className:"h-4 w-4"})})]})]})},s.id)})})}),n&&e.jsx(H,{roles:w||[],onClose:()=>i(!1),onSubmit:q}),x&&a&&e.jsx(I,{user:a,roles:w||[],onClose:()=>{t(!1),r(null)},onSubmit:F})]})}function H({roles:l,onClose:u,onSubmit:m}){const[d,n]=c.useState({email:"",password:T(),full_name:"",role_ids:[],menu_access:[],sub_menu_access:{},component_access:[]}),i=t=>{if(t.preventDefault(),d.role_ids.length===0){alert("Please select at least one role");return}m(d)},x=(t,a)=>{n(r=>({...r,role_ids:a?[...new Set([...r.role_ids,t])]:r.role_ids.filter(o=>o!==t)}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New User"}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:d.email,onChange:t=>n(a=>({...a,email:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:d.full_name,onChange:t=>n(a=>({...a,full_name:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Temporary Password"}),e.jsx("input",{type:"text",value:d.password,onChange:t=>n(a=>({...a,password:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"User will be required to change this password on first login"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Roles"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:l.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.role_ids.includes(t.id),onChange:a=>x(t.id,a.target.checked),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t.name})]},t.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create User"})]})]})]})})})}function I({user:l,roles:u,onClose:m,onSubmit:d}){const[n,i]=c.useState({full_name:l.full_name,role_ids:l.role_ids||[],menu_access:l.menu_access||[],sub_menu_access:l.sub_menu_access||{},component_access:l.component_access||[],is_active:l.is_active,needs_password_reset:l.needs_password_reset||!1}),x=a=>{if(a.preventDefault(),n.role_ids.length===0){alert("Please select at least one role");return}d(n)},t=(a,r)=>{i(o=>({...o,role_ids:r?[...new Set([...o.role_ids,a])]:o.role_ids.filter(h=>h!==a)}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",value:l.email,disabled:!0,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:n.full_name,onChange:a=>i(r=>({...r,full_name:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Roles"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:u.map(a=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.role_ids.includes(a.id),onChange:r=>t(a.id,r.target.checked),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:a.name})]},a.id))})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:n.is_active,onChange:a=>i(r=>({...r,is_active:a.target.checked})),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Active"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"needs_password_reset",checked:n.needs_password_reset,onChange:a=>i(r=>({...r,needs_password_reset:a.target.checked})),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("label",{htmlFor:"needs_password_reset",className:"ml-2 text-sm text-gray-700",children:"Require password reset"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Update User"})]})]})]})})})}export{X as AdminUsers};
